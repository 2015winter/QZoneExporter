<!DOCTYPE html>
<html lang="zh">

<head>
	<link rel="icon" href="../Common/images/favicon.ico">
	<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>QQ空间备份-相片</title>
	<link rel="stylesheet" href="../Common/vendor/css/font-awesome.min.css">
	<link rel="stylesheet" href="../Common/vendor/css/bootstrap.min.css">
	<link rel="stylesheet" href="../Common/vendor/css/lightgallery.min.css">
	<link rel="stylesheet" href="../Common/vendor/css/lightgallery-bundle.min.css">
	<link rel="stylesheet" type="text/css" href="../Common/css/common.css">
	<script src="../Common/vendor/js/jquery.min.js"></script>
	<script src="../Common/vendor/js/jquery.mousewheel.min.js"></script>
	<script src="../Common/vendor/js/bootstrap.bundle.min.js"></script>
	<script src="../Common/vendor/js/lodash.min.js"></script>
	
	<script src="../Common/vendor/js/lightgallery.min.js"></script>
	<script src="../Common/vendor/js/lg-zoom.min.js"></script>
	<script src="../Common/vendor/js/lg-video.min.js"></script>
	<script src="../Common/vendor/js/lg-thumbnail.min.js"></script>
	<script src="../Common/vendor/js/lg-rotate.min.js"></script>
	<script src="../Common/vendor/js/lg-hash.min.js"></script>
	<script src="../Common/vendor/js/lg-fullscreen.min.js"></script>
	<script src="../Common/vendor/js/lg-comment.min.js"></script>
	<script src="../Common/vendor/js/lg-autoplay.min.js"></script>

	<script src="../Common/vendor/js/lazyload.min.js"></script>
	<script src="../Common/vendor/js/index.aio.min.js"></script>
	<script src="../Common/vendor/js/clicklove.min.js"></script>
	
	<script type="text/javascript" src="../Common/json/config.js"></script>

	<script type="text/javascript" src="../Albums/json/albums.js"></script>
	<style>
		/* 相册详情页样式 - 绿色主题 #38ef7d 与Albums/index.html统一 */
		body {
			background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
			min-height: 100vh;
		}
		
		/* 主容器 - 与albums-container完全一致，增加左边距避免被遮挡 */
		.photos-container {
			padding: 80px 30px 40px 30px;
			max-width: none !important;
			transition: margin-left 0.1s ease;
		}
		
		@media (min-width: 1001px) {
			.photos-container {
				margin-left: 220px; /* 会被JS动态调整 */
			}
		}
		
		/* 移除tz-gallery所有默认边距 */
		.photos-container .tz-gallery,
		.photos-container .photos-toolbar,
		.photos-container .photos-grid {
			padding-left: 0;
			padding-right: 0;
			margin-left: 0;
			margin-right: 0;
		}
		
		@media (max-width: 1000px) {
			.photos-container {
				margin-left: 0 !important;
				padding: 70px 15px 30px 15px;
			}
		}
		
		/* 相册标题样式 - h2用于侧边栏 */
		h2.photos-title {
			margin: 0 0 24px 0;
			font-size: inherit;
			font-weight: normal;
		}
		
		.photos-header {
			display: flex;
			align-items: center;
			padding: 16px 24px;
			background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
			border-radius: 16px;
			box-shadow: 0 8px 24px rgba(17, 153, 142, 0.3);
		}
		
		.photos-icon {
			width: 48px;
			height: 48px;
			background: rgba(255, 255, 255, 0.2);
			border-radius: 12px;
			display: flex;
			align-items: center;
			justify-content: center;
			margin-right: 16px;
			flex-shrink: 0;
		}
		
		.photos-icon i {
			font-size: 24px;
			color: #fff;
		}
		
		.photos-title-text {
			color: #fff;
			font-size: 22px;
			font-weight: 700;
			text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			flex: 1;
		}
		
		.photos-count {
			background: rgba(255, 255, 255, 0.25);
			color: #fff;
			font-size: 14px;
			font-weight: 600;
			padding: 6px 16px;
			border-radius: 20px;
			white-space: nowrap;
			flex-shrink: 0;
		}
		
		/* 照片网格 */
		.photos-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
			gap: 20px;
		}
		
		/* 工具栏样式美化 */
		.photos-toolbar {
			background: #fff;
			padding: 16px 24px;
			border-radius: 16px;
			box-shadow: 0 4px 20px rgba(0,0,0,0.06);
			margin-bottom: 24px;
			border: 1px solid rgba(17, 153, 142, 0.1);
		}
		
		.photos-toolbar .album-stats {
			display: flex;
			gap: 12px;
			align-items: center;
		}
		
		.photos-toolbar .album-stats .badge {
			font-size: 13px;
			font-weight: 500;
			padding: 8px 16px;
			border-radius: 20px;
			display: inline-flex;
			align-items: center;
			gap: 6px;
		}
		
		.photos-toolbar .album-stats .badge-info {
			background: linear-gradient(135deg, #11998e, #38ef7d);
			border: none;
		}
		
		.photos-toolbar .album-stats .badge-secondary {
			background: linear-gradient(135deg, #f093fb, #f5576c);
			border: none;
		}
		
		.photos-toolbar .layout-controls {
			display: flex;
			align-items: center;
			gap: 12px;
		}
		
		.photos-toolbar .btn-group .btn {
			border-radius: 8px !important;
			padding: 6px 14px;
			font-size: 13px;
			border-color: #e0e0e0;
			color: #666;
			transition: all 0.2s ease;
		}
		
		.photos-toolbar .btn-group .btn:hover {
			background: linear-gradient(135deg, #11998e, #38ef7d);
			border-color: transparent;
			color: #fff;
		}
		
		.photos-toolbar .btn-group .btn.active {
			background: linear-gradient(135deg, #11998e, #38ef7d);
			border-color: transparent;
			color: #fff;
		}
		
		.photos-toolbar .btn-group .btn i {
			margin-right: 4px;
		}
		
		/* 下拉按钮样式 - 高优先级覆盖 */
		.photos-toolbar .btn-group .btn.dropdown-toggle,
		.photos-toolbar .dropdown-toggle {
			background: #fff !important;
			border: 1px solid #e0e0e0 !important;
			color: #666 !important;
		}
		
		.photos-toolbar .btn-group .btn.dropdown-toggle:hover,
		.photos-toolbar .btn-group .btn.dropdown-toggle:focus,
		.photos-toolbar .dropdown-toggle:hover,
		.photos-toolbar .dropdown-toggle:focus {
			background: linear-gradient(135deg, #11998e, #38ef7d) !important;
			border-color: transparent !important;
			color: #fff !important;
		}
		
		.photos-toolbar .dropdown-menu {
			border-radius: 12px;
			border: none;
			box-shadow: 0 8px 24px rgba(0,0,0,0.12);
			padding: 8px 0;
			min-width: 140px;
		}
		
		.photos-toolbar .dropdown-item {
			padding: 10px 16px;
			font-size: 13px;
			color: #555;
			transition: all 0.2s ease;
		}
		
		.photos-toolbar .dropdown-item:hover {
			background: linear-gradient(135deg, #11998e, #38ef7d);
			color: #fff;
		}
		
		.photos-toolbar .dropdown-item.active {
			background: linear-gradient(135deg, #11998e, #38ef7d);
			color: #fff;
		}
		
		.photos-toolbar .dropdown-item i {
			margin-right: 8px;
			width: 16px;
		}
		
		/* 响应式 */
		@media (max-width: 768px) {
			.photos-toolbar {
				padding: 12px 16px;
			}
			
			.photos-toolbar .d-flex {
				flex-direction: column;
				gap: 12px;
			}
			
			.photos-toolbar .album-stats {
				justify-content: center;
			}
			
			.photos-toolbar .layout-controls {
				justify-content: center;
				flex-wrap: wrap;
			}
			
			.photos-header {
				padding: 12px 16px;
				border-radius: 12px;
			}
			
			.photos-icon {
				width: 40px;
				height: 40px;
			}
			
			.photos-title-text {
				font-size: 18px;
			}
			
			.photos-grid {
				grid-template-columns: repeat(2, 1fr);
				gap: 12px;
			}
			
			.photos-grid .photo-item .pic-num-wrap {
				padding: 16px 8px 8px !important;
			}
			
			.photos-grid .photo-item .pic-num-wrap span.cursor {
				font-size: 12px;
			}
		}
	</style>
</head>

<body>
	<header>
		<nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background: linear-gradient(135deg, rgba(17, 153, 142, 0.95), rgba(56, 239, 125, 0.95)); backdrop-filter: blur(10px);">
			<a class="navbar-brand" target="_blank" href="https://github.com/ShunCai/QZoneExport">
				<i class="fa fa-cloud-download mr-2"></i>QQ空间导出助手
			</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb" style="background: transparent; margin-bottom: 0;">
						<li class="breadcrumb-item"><a href="../index.html" style="color: rgba(255,255,255,0.85);"><i class="fa fa-home mr-1"></i>个人中心</a></li>
						<li class="breadcrumb-item"><a href="index.html" style="color: rgba(255,255,255,0.85);">相册</a></li>
						<li class="breadcrumb-item active" aria-current="page" style="color: rgba(255,255,255,0.95);">相册名称</li>
					</ol>
				</nav>
			</div>
		</nav>
	</header>
	<main role="main">
		<div class="photos-container" id="photos_html">
			<!-- 分类标题 - h1用于侧边栏一级 -->
			<h1 class="sidebar-h1" data-sidebar='<%:=album.className || "相册"%><span class="badge badge-primary badge-pill itemSize">1</span>' style="display:none;"></h1>
			
			<!-- 相册标题 - h2用于侧边栏二级（不带数量，与index.html一致） -->
			<h2 class="photos-title sidebar-h2" data-sidebar='<%:=album.name%>'>
				<div class="photos-header">
					<div class="photos-icon">
						<i class="fa fa-folder-open"></i>
					</div>
					<span class="photos-title-text"><%:=album.name%></span>
					<span class="photos-count"><%:=album.photoList ? album.photoList.length : 0%> 张相片</span>
				</div>
			</h2>
			
			<div class="tz-gallery">
				<!-- 相册工具栏 -->
				<div class="photos-toolbar mb-4">
					<div class="d-flex justify-content-between align-items-center flex-wrap">
						<div class="album-stats">
							<span class="badge badge-info"><i class="fa fa-image mr-1"></i> <span id="photoCount">0 张相片</span></span>
							<span class="badge badge-secondary"><i class="fa fa-video-camera mr-1"></i> <span id="videoCount">0 个视频</span></span>
						</div>
						<div class="layout-controls">
							<div class="btn-group btn-group-sm" role="group">
								<button type="button" class="btn btn-outline-secondary" data-layout="grid" title="网格视图">
									<i class="fa fa-th"></i> 网格
								</button>
								<button type="button" class="btn btn-outline-secondary active" data-layout="timeline" title="时间线视图">
									<i class="fa fa-calendar"></i> 时间
								</button>
								<button type="button" class="btn btn-outline-secondary" data-layout="masonry" title="瀑布流视图">
									<i class="fa fa-columns"></i> 瀑布
								</button>
							</div>
							<div class="btn-group btn-group-sm ml-2" role="group">
								<button type="button" class="btn btn-outline-secondary dropdown-toggle" data-toggle="dropdown" title="排序">
									<i class="fa fa-sort-amount-desc"></i> 排序
								</button>
								<div class="dropdown-menu dropdown-menu-right">
									<a class="dropdown-item active" href="#" data-sort="time-desc"><i class="fa fa-sort-numeric-desc"></i> 最新优先</a>
									<a class="dropdown-item" href="#" data-sort="time-asc"><i class="fa fa-sort-numeric-asc"></i> 最早优先</a>
									<a class="dropdown-item" href="#" data-sort="name"><i class="fa fa-sort-alpha-asc"></i> 按名称</a>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div id="lightgallery" class="photos layout-timeline photos-grid">
					<script id="photos_tpl" type="text/html">
						<%/* 遍历相片 */%>
						<%if(album && album.photoList && album.photoList.length > 0){%>
						<%for (const photo of album.photoList) {%>
							<%photo.uid = 'QZ-' + API.Utils.newSimpleUid(16)%>
							<%photo.custom_lbs = API.Photos.getPhotoLbs(photo)%>
							<%const photoTime = (photo.rawshoottime || photo.shootTime) || (photo.uploadtime || photo.uploadTime)%>
							<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-6 mb-3 photo-item" data-time="<%:=photoTime%>">
								<div class="card thumbnail shadow-sm">
									<%/* 详情面板 - 非本地照片显示 */%>
									<%if(!photo.isLocal){%>
										<div id="<%:=photo.uid%>" class='photo-detail' style="display:none">
											<div class="d-flex justify-content-between">
												<div class="col text-white-50 text-left">
													<p>
														<i title="相片尺寸（非原图尺寸，仅供参考）"><%:=(photo.is_video && photo.video_info ? (photo.video_info.cover_width || 0) : (photo.width || 0)) + " * " + (photo.is_video && photo.video_info ? (photo.video_info.cover_height || 0) : (photo.height || 0))%></i>
														<i title="相片大小（非原图尺寸，仅供参考）" class="ml-2"><%:=API.Utils.formatFileSize(photo.is_video && photo.video_info ? (photo.video_info.size || 0) : (photo.photocubage || 0))%></i>
														<i title="相片类型" class="ml-2"><%:=photo.is_video ? 'MP4' : API.Photos.getPhotoType(photo)%></i>
													</p>
													<p>
														<i title="拍摄/上传时间" class="fa fa-clock-o text-primary"><%:=API.Utils.formatDate(photoTime)%></i>
														<%if(photo.custom_lbs && (photo.custom_lbs.idname || photo.custom_lbs.name)){%>
															<a title="拍摄/上传地点" class="ml-2 text-primary" href="<%:=API.Messages.getMapUrl(photo.custom_lbs)%>" target="_blank"><i class="fa fa-map-marker"></i><%:=photo.custom_lbs.idname || photo.custom_lbs.name%></a>
														<%}%>
													</p>
												</div>
												<div class="col text-center text-truncate">
													<%if(photo.name){%>
														<h6 data-toggle="tooltip" data-html="true" title="<%:=API.Common.formatContent(photo.name, 'HTML', false, false, false, false, true)%>"><%:=API.Common.formatContent(photo.name, "HTML", false, false, false, false, true)%></h6>
													<%}%>
													<%if(photo.desc){%>
														<span class="text-white-50" data-toggle="tooltip" data-html="true" title="<%:=API.Common.formatContent(photo.desc, 'HTML', false, false, false, false, true)%>"><%:=API.Common.formatContent(photo.desc, "HTML", false, false, false, false, true)%></span>
													<%}%>
												</div>
												<div class="col"></div>
											</div>
										</div>
									<%}%>
								<%/* 视频类型处理 */%>
								<%if(photo.is_video && photo.video_info){%>
									<%/* 获取视频路径：custom_filepath是视频文件路径，custom_pre_filepath是封面图路径 */%>
									<%const videoSrc = API.Common.getMediaPath(photo.video_info.video_url, photo.custom_filepath, true) || '../Common/images/loading.gif'%>
									<%const videoPoster = API.Common.getMediaPath(photo.custom_url || photo.pre, photo.custom_pre_filepath, true) || '../Common/images/loading.gif'%>
									<a class="lightbox" data-video='{"source": [{"src":"<%:=videoSrc%>", "type":"video/mp4"}],"attributes": {"preload": false, "controls": true}}' 
										data-poster="<%:=videoPoster%>" data-sub-html="#<%:=photo.uid%>">
										<span class="photo-video"></span>
										<img class="lazyload loading card-img photo-thumb" src="<%:=videoPoster%>" data-src="<%:=videoPoster%>" />
									</a>
									<div class="card-body text-truncate" data-toggle="tooltip" data-html="true" title="<%:=API.Photos.getPhotoBasicInfoTooltip(photo)%>">
										<span class="card-title"><%:=(API.Common.formatContent(photo.name, 'HTML', false, false, false, false, true) || API.Utils.formatDate(photo.uploadtime || photo.uploadTime))%></span>
									</div>
									<div class="pic-num-wrap d-flex justify-content-around">
									<div class="align-self-end">
										<span class="text-light fa fa-heart cursor viewlikes" title="查看点赞" data-field="uniKey" data-target="<%:=photo.uniKey%>"><%:=photo.likes ? photo.likes.length : 0%></span>
									</div>
									<div class="align-self-end">
										<span class="text-light fa fa-comment cursor viewcomments" title="查看评论" data-field="uniKey" data-target="<%:=photo.uniKey%>"><%:=photo.comments ? photo.comments.length : 0%></span>
									</div>
								</div>
							<%}else{%>
									<%/* 图片类型处理 */%>
									<%const photoHref = API.Common.getMediaPath(photo.custom_url, photo.custom_filepath, true) || '../Common/images/loading.gif'%>
									<%const photoSrc = API.Common.getMediaPath(photo.custom_url || photo.pre, photo.custom_pre_filepath || photo.custom_filepath, true) || '../Common/images/loading.gif'%>
									<a class="lightbox" href="<%:=photoHref%>" data-sub-html="#<%:=photo.uid%>">
										<img class="lazyload loading card-img photo-thumb" src="<%:=photoSrc%>" data-src="<%:=photoSrc%>">
									</a>
									<div class="card-body text-truncate" data-toggle="tooltip" data-html="true" title="<%:=API.Photos.getPhotoBasicInfoTooltip(photo)%>">
										<span class="card-title"><%:=(API.Common.formatContent(photo.name, 'HTML', false, false, false, false, true) || API.Utils.formatDate(photo.uploadtime || photo.uploadTime))%></span>
									</div>
									<div class="pic-num-wrap d-flex justify-content-around">
									<div class="align-self-end">
										<span class="text-light fa fa-heart cursor viewlikes" title="查看点赞" data-field="uniKey" data-target="<%:=photo.uniKey%>"><%:=photo.likes ? photo.likes.length : 0%></span>
									</div>
									<div class="align-self-end">
										<span class="text-light fa fa-comment cursor viewcomments" title="查看评论" data-field="uniKey" data-target="<%:=photo.uniKey%>"><%:=photo.comments ? photo.comments.length : 0%></span>
									</div>
								</div>
							<%}%>
							</div>
							</div>
						<%}%>
						<%}else{%>
							<div class="col-12 text-center text-muted py-5">
								<i class="fa fa-image fa-3x mb-3"></i>
								<p>暂无相片</p>
							</div>
						<%}%>
					</script>
				</div>
			</div>
		</div>
	</main>
	
	<!-- 相片预览弹窗 -->
	<div class="photo-preview-overlay" id="photoPreviewOverlay">
		<div class="photo-preview-modal">
			<div class="photo-preview-header">
				<span class="photo-preview-title" id="previewTitle">相片预览</span>
				<div class="photo-preview-actions">
					<button class="photo-preview-btn btn-fullscreen" id="btnFullscreen" title="全屏查看">
						<i class="fa fa-expand"></i>
					</button>
					<button class="photo-preview-btn btn-close-preview" id="btnClosePreview" title="关闭">
						<i class="fa fa-times"></i>
					</button>
				</div>
			</div>
			<button class="photo-preview-nav prev" id="btnPrevPhoto" title="上一张">
				<i class="fa fa-chevron-left"></i>
			</button>
			<div class="photo-preview-content" id="previewContent">
				<div class="photo-preview-loading" id="previewLoading">加载中...</div>
			</div>
			<button class="photo-preview-nav next" id="btnNextPhoto" title="下一张">
				<i class="fa fa-chevron-right"></i>
			</button>
			<div class="photo-preview-footer">
				<div class="photo-preview-info" id="previewInfo"></div>
			</div>
		</div>
	</div>
	
	<script type="text/javascript">
		// 当前相册ID
		window.albumId ='<%:=(albumId)%>';
	</script>
	<script type="text/javascript" src="../Common/js/common.js"></script>
	<script type="text/javascript" src="../Common/js/sidebar.js"></script>
	<script type="text/javascript" src="js/photos.js"></script>
</body>

</html>