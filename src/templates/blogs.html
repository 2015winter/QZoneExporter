<!DOCTYPE html>
<html lang="zh">

<head>
	<link rel="icon" href="../Common/images/favicon.ico"> 
	<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>QQ空间备份-日志</title>
	<link rel="stylesheet" href="../Common/vendor/css/font-awesome.min.css">
	<link rel="stylesheet" href="../Common/vendor/css/bootstrap.min.css">
	<link rel="stylesheet" href="../Common/vendor/css/bootstrap-table.min.css">
	<link rel="stylesheet" type="text/css" href="../Common/css/common.css">
	<script src="../Common/vendor/js/jquery.min.js"></script>
	<script src="../Common/vendor/js/bootstrap.bundle.min.js"></script>
	<script src="../Common/vendor/js/bootstrap-table.min.js"></script>
	<script src="../Common/vendor/js/bootstrap-table-zh-CN.min.js"></script>
	<script src="../Common/vendor/js/index.aio.min.js"></script>
	<script src="../Common/vendor/js/lodash.min.js"></script>
	<script src="../Common/vendor/js/clicklove.min.js"></script>
	
	<script src="../Common/json/config.js"></script>
	<script src="json/blogs.js"></script>
	<script src="../Common/js/common.js"></script>
	<script src="js/blogs.js"></script>
	
	<style>
		/* 始终显示滚动条，避免切换时布局偏移 */
		html {
			overflow-y: scroll;
		}
		
		/* 日志页面专属样式 - 与首页风格一致 */
		body.blogs-page {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
			min-height: 100vh;
			padding-top: 70px;
			padding-bottom: 80px;
		}
		
		/* 导航栏样式 */
		.blogs-navbar {
			background: linear-gradient(135deg, rgba(102, 126, 234, 0.95), rgba(118, 75, 162, 0.95)) !important;
			backdrop-filter: blur(10px);
		}
		
		.blogs-breadcrumb {
			background: transparent !important;
		}
		
		.blogs-breadcrumb .breadcrumb-item a {
			color: rgba(255, 255, 255, 0.85);
			transition: color 0.3s ease;
		}
		
		.blogs-breadcrumb .breadcrumb-item a:hover {
			color: #fff;
			text-decoration: none;
		}
		
		.blogs-breadcrumb .breadcrumb-item.active {
			color: rgba(255, 255, 255, 0.9);
		}
		
		.blogs-breadcrumb .breadcrumb-item + .breadcrumb-item::before {
			color: rgba(255, 255, 255, 0.5);
		}
		
		/* 主卡片容器 */
		.blogs-main-card {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(20px);
			border-radius: 24px;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
			padding: 40px;
			margin-top: 20px;
		}
		
		/* 页面标题区域 */
		.blogs-header {
			text-align: center;
			margin-bottom: 40px;
			padding-bottom: 30px;
			border-bottom: 1px solid rgba(0, 0, 0, 0.08);
		}
		
		.blogs-header-icon {
			font-size: 48px;
			background: linear-gradient(135deg, #667eea, #764ba2);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
			margin-bottom: 16px;
			display: block;
		}
		
		.blogs-header-title {
			font-size: 32px;
			font-weight: 700;
			background: linear-gradient(135deg, #667eea, #764ba2);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
			margin-bottom: 12px;
		}
		
		.blogs-header-subtitle {
			color: #718096;
			font-size: 16px;
		}
		
		.blogs-total-count {
			font-weight: 600;
			color: #667eea;
		}
		
		/* 分类标签区域 */
		.blogs-categories {
			display: flex;
			flex-wrap: wrap;
			gap: 12px;
			justify-content: center;
			margin-bottom: 32px;
			padding-bottom: 24px;
			border-bottom: 1px solid rgba(0, 0, 0, 0.06);
		}
		
		.category-tag {
			display: inline-flex;
			align-items: center;
			gap: 8px;
			padding: 10px 20px;
			background: linear-gradient(145deg, #f8fafc, #fff);
			border: 1px solid rgba(102, 126, 234, 0.15);
			border-radius: 30px;
			font-size: 14px;
			color: #4a5568;
			cursor: pointer;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			text-decoration: none;
		}
		
		.category-tag:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(102, 126, 234, 0.2);
			background: linear-gradient(135deg, #667eea, #764ba2);
			color: #fff;
			text-decoration: none;
		}
		
		.category-tag.active {
			background: linear-gradient(135deg, #667eea, #764ba2);
			color: #fff;
			border-color: transparent;
			box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
		}
		
		.category-tag .count {
			display: inline-flex;
			align-items: center;
			justify-content: center;
			min-width: 24px;
			height: 24px;
			padding: 0 8px;
			background: rgba(102, 126, 234, 0.1);
			border-radius: 12px;
			font-size: 12px;
			font-weight: 600;
			color: #667eea;
			transition: all 0.3s ease;
		}
		
		.category-tag:hover .count,
		.category-tag.active .count {
			background: rgba(255, 255, 255, 0.25);
			color: #fff;
		}
		
		/* 日志列表网格 */
		.blogs-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
			gap: 24px;
		}
		
		/* 日志卡片 */
		.blog-card {
			background: linear-gradient(145deg, #f8fafc, #fff);
			border-radius: 16px;
			padding: 24px;
			text-decoration: none;
			color: inherit;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			border: 1px solid rgba(0, 0, 0, 0.05);
			position: relative;
			overflow: hidden;
			display: flex;
			flex-direction: column;
		}
		
		.blog-card::before {
			content: '';
			position: absolute;
			inset: 0;
			background: linear-gradient(135deg, #667eea, #764ba2);
			opacity: 0;
			transition: opacity 0.3s ease;
		}
		
		.blog-card:hover {
			transform: translateY(-8px);
			box-shadow: 0 15px 40px rgba(102, 126, 234, 0.25);
			text-decoration: none;
		}
		
		.blog-card:hover::before {
			opacity: 1;
		}
		
		.blog-card:hover .blog-title,
		.blog-card:hover .blog-category,
		.blog-card:hover .blog-time,
		.blog-card:hover .blog-stats {
			position: relative;
			z-index: 1;
			color: #fff;
		}
		
		.blog-card:hover .blog-category {
			background: rgba(255, 255, 255, 0.2);
		}
		
		.blog-card:hover .blog-stats span {
			color: rgba(255, 255, 255, 0.9);
		}
		
		.blog-title {
			font-size: 17px;
			font-weight: 600;
			color: #2d3748;
			margin-bottom: 12px;
			line-height: 1.5;
			display: -webkit-box;
			-webkit-line-clamp: 2;
			-webkit-box-orient: vertical;
			overflow: hidden;
			transition: color 0.3s ease;
		}
		
		.blog-category {
			display: inline-block;
			padding: 4px 12px;
			background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
			border-radius: 20px;
			font-size: 12px;
			font-weight: 500;
			color: #667eea;
			margin-bottom: 12px;
			transition: all 0.3s ease;
		}
		
		.blog-meta {
			margin-top: auto;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}
		
		.blog-time {
			font-size: 13px;
			color: #718096;
			transition: color 0.3s ease;
		}
		
		.blog-time i {
			margin-right: 6px;
		}
		
		.blog-stats {
			display: flex;
			gap: 12px;
		}
		
		.blog-stats span {
			font-size: 13px;
			color: #718096;
			display: flex;
			align-items: center;
			gap: 4px;
			transition: color 0.3s ease;
		}
		
		.blog-stats .fa-eye {
			color: #feca57;
		}
		
		.blog-stats .fa-comment {
			color: #4ecdc4;
		}
		
		.blog-stats .fa-thumbs-up {
			color: #ff6b6b;
		}
		
		/* 日志类型标签 */
		.blog-labels {
			position: absolute;
			top: 12px;
			right: 12px;
			display: flex;
			gap: 6px;
			z-index: 2;
		}
		
		.blog-label {
			padding: 3px 8px;
			font-size: 11px;
			font-weight: 600;
			border-radius: 4px;
			color: #fff;
		}
		
		.blog-label.original {
			background: linear-gradient(135deg, #11998e, #38ef7d);
		}
		
		.blog-label.repost {
			background: linear-gradient(135deg, #f093fb, #f5576c);
		}
		
		/* 底部 */
		.blogs-footer {
			background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.9));
			backdrop-filter: blur(10px);
			position: fixed;
			bottom: 0;
			left: 0;
			right: 0;
			z-index: 1000;
		}
		
		.footer-text {
			font-size: 14px;
			letter-spacing: 1px;
		}
		
		/* 搜索和筛选区 */
		.blogs-toolbar {
			display: flex;
			gap: 16px;
			margin-bottom: 24px;
			flex-wrap: wrap;
		}
		
		.blogs-search {
			flex: 1;
			min-width: 200px;
			position: relative;
		}
		
		.blogs-search input {
			width: 100%;
			padding: 12px 16px 12px 44px;
			border: 2px solid rgba(102, 126, 234, 0.2);
			border-radius: 30px;
			font-size: 14px;
			outline: none;
			transition: all 0.3s ease;
			background: #fff;
		}
		
		.blogs-search input:focus {
			border-color: #667eea;
			box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
		}
		
		.blogs-search i {
			position: absolute;
			left: 18px;
			top: 50%;
			transform: translateY(-50%);
			color: #718096;
		}
		
		.blogs-sort {
			display: flex;
			gap: 8px;
		}
		
		.sort-btn {
			padding: 10px 16px;
			border: 2px solid rgba(102, 126, 234, 0.2);
			border-radius: 20px;
			background: #fff;
			font-size: 13px;
			color: #4a5568;
			cursor: pointer;
			transition: all 0.3s ease;
		}
		
		.sort-btn:hover,
		.sort-btn.active {
			background: linear-gradient(135deg, #667eea, #764ba2);
			color: #fff;
			border-color: transparent;
		}
		
		/* 空状态 */
		.blogs-empty {
			text-align: center;
			padding: 60px 20px;
			color: #718096;
		}
		
		.blogs-empty i {
			font-size: 64px;
			margin-bottom: 20px;
			opacity: 0.3;
		}
		
		.blogs-empty p {
			font-size: 16px;
		}
		
		/* 响应式 */
		@media (max-width: 768px) {
			.blogs-main-card {
				padding: 24px 16px;
				margin: 10px;
				border-radius: 20px;
			}
			
			.blogs-header-icon {
				font-size: 36px;
			}
			
			.blogs-header-title {
				font-size: 24px;
			}
			
			.blogs-grid {
				grid-template-columns: 1fr;
				gap: 16px;
			}
			
			.blog-card {
				padding: 20px;
			}
			
			.blogs-categories {
				gap: 8px;
			}
			
			.category-tag {
				padding: 8px 14px;
				font-size: 13px;
			}
			
			.blogs-toolbar {
				flex-direction: column;
			}
			
			.blogs-sort {
				justify-content: center;
			}
		}
		
		/* 表格视图样式覆盖 */
		#blogs-table {
			border-radius: 16px;
			overflow: hidden;
		}
		
		.bootstrap-table .fixed-table-container {
			border-radius: 16px;
			border: none;
		}
		
		.bootstrap-table .table {
			margin-bottom: 0;
		}
		
		.bootstrap-table .table thead th {
			background: linear-gradient(135deg, #667eea, #764ba2);
			color: #fff;
			border: none;
			padding: 16px 12px;
		}
		
		.bootstrap-table .table tbody td {
			padding: 14px 12px;
			vertical-align: middle;
		}
		
		.bootstrap-table .table tbody tr:hover {
			background: rgba(102, 126, 234, 0.05);
		}
		
		/* 视图切换 */
		.view-toggle {
			display: flex;
			gap: 8px;
		}
		
		.view-btn {
			width: 40px;
			height: 40px;
			display: flex;
			align-items: center;
			justify-content: center;
			border: 2px solid rgba(102, 126, 234, 0.2);
			border-radius: 10px;
			background: #fff;
			color: #718096;
			cursor: pointer;
			transition: all 0.3s ease;
		}
		
		.view-btn:hover,
		.view-btn.active {
			background: linear-gradient(135deg, #667eea, #764ba2);
			color: #fff;
			border-color: transparent;
		}
	</style>
</head>

<body class="blogs-page">
	<header>
		<nav class="navbar navbar-expand-lg navbar-dark fixed-top blogs-navbar">
			<a class="navbar-brand" target="_blank" href="https://github.com/2015winter/QZoneExporter">
				<i class="fa fa-cloud-download mr-2"></i>QQ空间导出助手
			</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb blogs-breadcrumb">
						<li class="breadcrumb-item"><a href="../index.html"><i class="fa fa-home mr-1"></i>个人中心</a></li>
						<li class="breadcrumb-item active" aria-current="page"><i class="fa fa-book mr-1"></i>日志</li>
					</ol>
				</nav>
			</div>
		</nav>
	</header>
	
	<main role="main" class="flex-shrink-0">
		<div class="container">
			<div class="blogs-main-card">
				<!-- 页面标题 -->
				<div class="blogs-header">
					<i class="fa fa-book blogs-header-icon"></i>
					<h1 class="blogs-header-title">日志时光机</h1>
					<p class="blogs-header-subtitle">共 <span class="blogs-total-count" id="blogs-count">0</span> 篇日志，记录了青春岁月的点点滴滴</p>
				</div>
				
				<!-- 分类标签 -->
				<div class="blogs-categories" id="blogs-categories">
					<!-- 由JS动态渲染 -->
				</div>
				
				<!-- 工具栏 -->
				<div class="blogs-toolbar">
					<div class="blogs-search">
						<i class="fa fa-search"></i>
						<input type="text" id="blogs-search-input" placeholder="搜索日志标题...">
					</div>
					<div class="blogs-sort">
						<button class="sort-btn active" data-sort="time-desc">
							<i class="fa fa-sort-amount-desc mr-1"></i>最新
						</button>
						<button class="sort-btn" data-sort="time-asc">
							<i class="fa fa-sort-amount-asc mr-1"></i>最早
						</button>
						<button class="sort-btn" data-sort="view-desc">
							<i class="fa fa-eye mr-1"></i>最多浏览
						</button>
					</div>
					<div class="view-toggle">
						<button class="view-btn active" data-view="card" title="卡片视图">
							<i class="fa fa-th-large"></i>
						</button>
						<button class="view-btn" data-view="table" title="表格视图">
							<i class="fa fa-list"></i>
						</button>
					</div>
				</div>
				
				<!-- 日志列表 - 卡片视图 -->
				<div class="blogs-grid" id="blogs-grid">
					<!-- 由JS动态渲染 -->
				</div>
				
				<!-- 日志列表 - 表格视图 -->
				<div id="blogs-table-container" style="display: none;">
					<table id="blogs-table"></table>
				</div>
				
				<!-- 旧版列表（隐藏，保留兼容） -->
				<div id="blogs-list" style="display: none;"></div>
			</div>
		</div>
	</main>
	
	<footer class="footer mt-auto py-3 blogs-footer">
		<div class="container text-center">
			<span class="text-white footer-text">
				<i class="fa fa-leaf mr-2"></i>落叶随风，青春，稍纵即逝
			</span>
		</div>
	</footer>
	
	<script>
	$(function() {
		// 日志数据
		const allBlogs = typeof blogs !== 'undefined' ? blogs : [];
		let filteredBlogs = [...allBlogs];
		let currentCategory = 'all';
		let currentSort = 'time-desc';
		let currentView = 'card';
		
		// 更新总数
		$('#blogs-count').text(allBlogs.length);
		
		// 渲染分类标签
		function renderCategories() {
			const categoryMaps = {};
			allBlogs.forEach(blog => {
				const cat = blog.category || '未分类';
				if (!categoryMaps[cat]) categoryMaps[cat] = 0;
				categoryMaps[cat]++;
			});
			
			let html = '<a class="category-tag active" data-category="all">全部<span class="count">' + allBlogs.length + '</span></a>';
			for (const [cat, count] of Object.entries(categoryMaps)) {
				html += '<a class="category-tag" data-category="' + cat + '">' + cat + '<span class="count">' + count + '</span></a>';
			}
			$('#blogs-categories').html(html);
		}
		
		// 格式化日期 - 兼容多种格式
		function formatBlogDate(pubTime, pubtime) {
			// 优先使用 pubTime
			let time = pubTime || pubtime;
			if (!time) return '';
			
			// 如果是字符串格式（如 "2024-01-01 12:00:00"）直接返回日期部分
			if (typeof time === 'string') {
				// 提取日期部分
				const match = time.match(/(\d{4}-\d{2}-\d{2})/);
				return match ? match[1] : time.split(' ')[0];
			}
			
			// 如果是数字（时间戳），转换为日期
			if (typeof time === 'number') {
				// 判断是秒级还是毫秒级时间戳
				const timestamp = time < 10000000000 ? time * 1000 : time;
				const date = new Date(timestamp);
				if (isNaN(date.getTime())) return '';
				const y = date.getFullYear();
				const m = String(date.getMonth() + 1).padStart(2, '0');
				const d = String(date.getDate()).padStart(2, '0');
				return y + '-' + m + '-' + d;
			}
			
			return '';
		}
		
		// 获取排序用的时间戳
		function getBlogTimestamp(blog) {
			const time = blog.pubTime || blog.pubtime;
			if (!time) return 0;
			
			if (typeof time === 'string') {
				return new Date(time).getTime() || 0;
			}
			if (typeof time === 'number') {
				return time < 10000000000 ? time * 1000 : time;
			}
			return 0;
		}
		
		// 判断是否为转载
		function isRepostBlog(blog) {
			// 使用 API.Blogs.getBlogLabel 判断
			if (typeof API !== 'undefined' && API.Blogs && API.Blogs.getBlogLabel) {
				const labels = API.Blogs.getBlogLabel(blog);
				return labels.indexOf('转载') > -1;
			}
			// 备用判断：检查 rt_uin 或 effect 字段
			if (blog.rt_uin) return true;
			// 检查 effect 位（3, 28, 35, 36 位表示转载）
			const effect = blog.effect || blog.effect1 || 0;
			if ((effect & (1 << 3)) || (effect & (1 << 28))) return true;
			return false;
		}
		
		// 渲染日志卡片
		function renderBlogsGrid() {
			if (filteredBlogs.length === 0) {
				$('#blogs-grid').html('<div class="blogs-empty"><i class="fa fa-book"></i><p>暂无日志</p></div>');
				return;
			}
			
			let html = '';
			filteredBlogs.forEach(blog => {
				const blogId = blog.blogid || blog.blogId;
				const title = blog.title || '无标题';
				const category = blog.category || '未分类';
				const pubTime = formatBlogDate(blog.pubTime, blog.pubtime);
				const viewCount = (blog.custom_visitor && blog.custom_visitor.viewCount) || 0;
				const replyNum = blog.replynum || 0;
				const isRepost = isRepostBlog(blog);
				
				html += '<a href="info.html?blogId=' + blogId + '" class="blog-card">';
				
				// 标签
				html += '<div class="blog-labels">';
				if (isRepost) {
					html += '<span class="blog-label repost">转载</span>';
				} else {
					html += '<span class="blog-label original">原创</span>';
				}
				html += '</div>';
				
				html += '<div class="blog-title">' + title + '</div>';
				html += '<div class="blog-category">' + category + '</div>';
				html += '<div class="blog-meta">';
				html += '<span class="blog-time"><i class="fa fa-clock-o"></i>' + pubTime + '</span>';
				html += '<div class="blog-stats">';
				html += '<span><i class="fa fa-eye"></i>' + viewCount + '</span>';
				html += '<span><i class="fa fa-comment"></i>' + replyNum + '</span>';
				html += '</div>';
				html += '</div>';
				html += '</a>';
			});
			
			$('#blogs-grid').html(html);
		}
		
		// 筛选和排序
		function filterAndSort() {
			// 筛选分类
			if (currentCategory === 'all') {
				filteredBlogs = [...allBlogs];
			} else {
				filteredBlogs = allBlogs.filter(b => (b.category || '未分类') === currentCategory);
			}
			
			// 搜索
			const searchText = $('#blogs-search-input').val().trim().toLowerCase();
			if (searchText) {
				filteredBlogs = filteredBlogs.filter(b => (b.title || '').toLowerCase().includes(searchText));
			}
			
			// 排序
			filteredBlogs.sort((a, b) => {
				switch (currentSort) {
					case 'time-desc':
						return getBlogTimestamp(b) - getBlogTimestamp(a);
					case 'time-asc':
						return getBlogTimestamp(a) - getBlogTimestamp(b);
					case 'view-desc':
						const aView = (a.custom_visitor && a.custom_visitor.viewCount) || 0;
						const bView = (b.custom_visitor && b.custom_visitor.viewCount) || 0;
						return bView - aView;
					default:
						return 0;
				}
			});
			
			renderBlogsGrid();
		}
		
		// 分类点击
		$(document).on('click', '.category-tag', function() {
			$('.category-tag').removeClass('active');
			$(this).addClass('active');
			currentCategory = $(this).data('category');
			filterAndSort();
		});
		
		// 排序点击
		$('.sort-btn').on('click', function() {
			$('.sort-btn').removeClass('active');
			$(this).addClass('active');
			currentSort = $(this).data('sort');
			filterAndSort();
		});
		
		// 视图切换
		$('.view-btn').on('click', function() {
			$('.view-btn').removeClass('active');
			$(this).addClass('active');
			currentView = $(this).data('view');
			
			if (currentView === 'card') {
				$('#blogs-grid').show();
				$('#blogs-table-container').hide();
			} else {
				$('#blogs-grid').hide();
				$('#blogs-table-container').show();
				// 初始化表格（如果尚未初始化）
				if ($('#blogs-table').find('tbody').length === 0) {
					API.Blogs.showTableList();
				}
			}
		});
		
		// 搜索
		let searchTimer;
		$('#blogs-search-input').on('input', function() {
			clearTimeout(searchTimer);
			searchTimer = setTimeout(filterAndSort, 300);
		});
		
		// 初始化
		renderCategories();
		filterAndSort();
	});
	</script>
</body>

</html>
